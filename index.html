<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - PROMED MEDICAL LICENSE</title>
    
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; }
        .text-promed { color: #8DC63F; }
        .bg-promed { background-color: #8DC63F; }
        .btn-promed:hover { background-color: #7ab332; }
        
        /* Tab Styles */
        .tab-active { border-bottom: 3px solid #8DC63F; color: #8DC63F; font-weight: bold; background-color: white; }
        .tab-inactive { color: #888; }
        
        /* Price Strike */
        .price-strike { text-decoration: line-through; color: #999; font-size: 0.8em; }
        
        /* Loading Spinner */
        .loader { 
            border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #8DC63F; 
            width: 20px; height: 20px; animation: spin 1s linear infinite; 
        }
        .main-loader {
            border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #8DC63F; 
            width: 40px; height: 40px; animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Smooth Fade In */
        .animate-fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Hide scrollbar for tabs */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen relative">

    <div id="pdpaModal" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full overflow-hidden animate-fade-in">
            <div class="p-5 border-b border-gray-100">
                <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-promed" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </h2>
            </div>
            <div class="p-5">
                <div class="text-sm text-gray-600 mb-4 h-32 overflow-y-auto border rounded-lg p-3 bg-gray-50 leading-relaxed">
                    <p class="font-bold mb-1">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (PDPA)</p>
                    <p>PROMED ‡∏Ç‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô (‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, ‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏≠‡∏î‡∏µ ‡∏Ø‡∏•‡∏Ø) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</p>
                </div>
                <label class="flex items-start space-x-3 cursor-pointer">
                    <input type="checkbox" id="pdpaCheckbox" class="mt-1 w-5 h-5 text-green-600 rounded border-gray-300 focus:ring-green-500">
                    <span class="text-sm text-gray-700 select-none">‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö <b class="text-gray-900">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</b></span>
                </label>
            </div>
            <div class="p-5 border-t border-gray-100 bg-gray-50">
                <button id="pdpaBtn" disabled class="w-full bg-gray-300 text-white font-bold py-3 rounded-xl transition-all duration-300 cursor-not-allowed">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
                </button>
            </div>
        </div>
    </div>

    <div id="courseInfoPage" class="hidden max-w-md mx-auto bg-white min-h-screen shadow-xl pb-24">
        <div class="bg-white p-4 text-center border-b shadow-sm sticky top-0 z-20">
             <div class="h-16 w-full flex items-center justify-center mb-1">
                <img id="logoImgInfo" src="" alt="PROMED Logo" class="h-full w-auto object-contain">
            </div>
            <h1 class="text-lg font-bold text-gray-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h1>
        </div>

        <div id="tabsContainer" class="flex border-b bg-gray-50 sticky top-[90px] z-10 overflow-x-auto no-scrollbar shadow-sm">
            </div>

        <div id="contentContainer" class="p-4 space-y-4 min-h-[50vh]">
            <div class="flex flex-col items-center justify-center py-20 space-y-3">
                <div class="main-loader"></div>
                <p class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...</p>
            </div>
        </div>
        
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] max-w-md mx-auto z-30">
            <button id="goToRegisterBtn" class="w-full bg-promed text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-[#7ab332] transition duration-300 flex justify-center items-center gap-2 text-lg">
                <span>üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
            </button>
        </div>
    </div>

    <div id="regisFormPage" class="hidden max-w-md mx-auto bg-white min-h-screen shadow-xl relative pb-10">
        <div class="bg-white p-6 text-center border-b border-gray-100 sticky top-0 z-20 shadow-sm">
            <div class="h-16 w-full flex items-center justify-center mb-1">
                <img id="logoImgForm" src="" alt="PROMED Logo" class="h-full w-auto object-contain">
            </div>
            <h1 class="text-xl font-bold text-gray-800">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p class="text-promed font-medium text-sm">PROMED MEDICAL LICENSE</p>
        </div>

        <div class="px-6 pt-6">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg shadow-sm">
                <p class="text-sm text-yellow-700">‚ö†Ô∏è <b>‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á 5 ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á/‡∏£‡∏≠‡∏ö</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏ï‡∏≤‡∏£‡∏≤‡∏á</p>
            </div>
        </div>

        <form id="regisForm" class="p-6 space-y-5">
            <input type="hidden" id="userId" name="userId">
            
            <div class="space-y-3">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider border-b pb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-500">*</span></label>
                    <input type="text" id="fullname" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô <span class="text-red-500">*</span></label>
                        <input type="text" id="nickname" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">‡∏≠‡∏≤‡∏¢‡∏∏</label>
                        <input type="number" id="age" class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô / ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ <span class="text-red-500">*</span></label>
                    <input type="text" id="education" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
            </div>

            <div class="space-y-3 pt-2">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider border-b pb-1">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
                    <input type="email" id="email" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Line ID <span class="text-red-500">*</span></label>
                    <input type="text" id="lineId" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô) <span class="text-red-500">*</span></label>
                    <input type="tel" id="phoneStudent" required class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á)</label>
                    <input type="tel" id="phoneParent" class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]">
                </div>
            </div>

            <div class="space-y-3 pt-2">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider border-b pb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á <span class="text-red-500">*</span></label>
                    <select id="subject" class="w-full border-gray-300 border p-3 rounded-lg mt-1 bg-white focus:outline-none focus:ring-2 focus:ring-[#8DC63F]"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                    <textarea id="preferredTime" rows="2" class="w-full border-gray-300 border p-3 rounded-lg mt-1 focus:outline-none focus:ring-2 focus:ring-[#8DC63F]" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå ‡∏´‡∏•‡∏±‡∏á 18.00 ‡∏ô."></textarea>
                </div>
            </div>

            <div class="pt-6">
                <button type="submit" id="submitBtn" class="w-full bg-promed text-white font-bold py-4 rounded-xl shadow-lg hover:bg-[#7ab332] transition duration-300 flex justify-center items-center gap-2 text-lg">
                    <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
                    <div id="loadingSpinner" class="loader hidden"></div>
                </button>
            </div>
            
            <div class="text-center pt-4">
                <button type="button" id="backToInfoBtn" class="text-sm text-gray-500 underline hover:text-gray-700">
                    ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≠‡∏£‡πå‡∏™
                </button>
            </div>
        </form>
    </div>

    <script>
        // ==========================================
        // ‚öôÔ∏è CONFIGURATION (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
        // ==========================================
        
        // 1. LIFF ID
        const LIFF_ID = '2009152707-JaNVAeT8'; 
        
        // 2. üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡∏ß‡∏≤‡∏á Web App URL ‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyKDekAqq2T7mq0nzvj4wroM5TuOYKFBAnQKJoCq8AAl_92LOtnDkwN2pQXhujFd_V3/exec'; 
        
        // 3. Logo ID
        const LOGO_FILE_ID = '2009199430-hBVGLTtW'; 

        // ==========================================
        // üèóÔ∏è GLOBALS & INIT
        // ==========================================
        let allCourses = [];
        let uniqueCategories = [];

        async function main() {
            setLogo();
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢
            await fetchCourses();
            
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° LIFF
            try {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) {
                    const profile = await liff.getProfile();
                    document.getElementById('userId').value = profile.userId;
                    // Auto-fill ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå (‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏≠‡∏≤ readonly ‡∏≠‡∏≠‡∏Å)
                    document.getElementById('lineId').value = profile.displayName;
                } else { 
                    liff.login(); 
                }
            } catch (err) { 
                console.error("LIFF Error:", err); 
            }
        }
        main();

        // ==========================================
        // üåê FETCH DATA & RENDER UI
        // ==========================================
        async function fetchCourses() {
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'fetch_courses' })
                });
                const json = await response.json();
                
                if(json.status === 'success' && json.data.length > 0) {
                    allCourses = json.data;
                    renderUI();
                } else {
                    showErrorUI("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
                }
            } catch (e) {
                console.error("Fetch Error", e);
                showErrorUI("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
            }
        }

        function showErrorUI(msg) {
            document.getElementById('contentContainer').innerHTML = `<div class="p-4 text-center text-red-500 font-semibold bg-red-50 rounded-lg border border-red-200 mt-4">${msg}</div>`;
        }

        function renderUI() {
            // 1. ‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
            const cats = [...new Set(allCourses.map(c => c.category))];
            uniqueCategories = cats;

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Tabs
            const tabsHtml = cats.map((cat, index) => 
                `<button onclick="switchTab('${cat}')" id="tab-${cat}" class="flex-1 min-w-[90px] py-4 text-center text-sm font-semibold whitespace-nowrap transition ${index===0 ? 'tab-active bg-white' : 'tab-inactive hover:bg-white'}">${cat}</button>`
            ).join('');
            document.getElementById('tabsContainer').innerHTML = tabsHtml;

            // 3. ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ Tab ‡πÅ‡∏£‡∏Å
            if (cats.length > 0) {
                renderContent(cats[0]);
            }

            // 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á Dropdown ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            const optionsHtml = allCourses.map(c => 
                `<option value="${c.id}">${c.dropdownName}</option>`
            ).join('');
            document.getElementById('subject').innerHTML = optionsHtml;
        }

        window.switchTab = function(category) {
            // ‡∏™‡∏•‡∏±‡∏ö Class ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° Tabs
            uniqueCategories.forEach(c => {
                const btn = document.getElementById(`tab-${c}`);
                if(c === category) {
                    btn.classList.add('tab-active', 'bg-white');
                    btn.classList.remove('tab-inactive');
                } else {
                    btn.classList.remove('tab-active', 'bg-white');
                    btn.classList.add('tab-inactive');
                }
            });
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
            renderContent(category);
        }

        function renderContent(category) {
            const courses = allCourses.filter(c => c.category === category);
            let html = '';
            
            // ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏µ‡∏ï‡∏≤‡∏° Category (‡∏•‡∏π‡∏Å‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°)
            let headerColor = 'bg-gray-100 text-gray-800 border-gray-200';
            let icon = 'üìò';
            
            if(category.toLowerCase().includes('pre')) { headerColor = 'bg-teal-50 text-teal-800 border-teal-200'; icon = 'üß¨'; }
            else if(category.includes('NL1')) { headerColor = 'bg-blue-50 text-blue-800 border-blue-200'; icon = 'üéì'; }
            else if(category.includes('NL2')) { headerColor = 'bg-green-50 text-green-800 border-green-200'; icon = 'üè•'; }
            else if(category.includes('MEQ')) { headerColor = 'bg-purple-50 text-purple-800 border-purple-200'; icon = '‚úçÔ∏è'; }
            
            html += `<div class="${headerColor} p-3 rounded-lg text-sm mb-4 border font-medium shadow-sm">${icon} ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: <b>${category}</b></div>`;

            courses.forEach(c => {
                const formatter = new Intl.NumberFormat('th-TH');
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏´‡∏°
                const isDiscount = c.fullPrice && parseFloat(c.fullPrice) > parseFloat(c.price);
                
                // ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏• ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏ü ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô)
                let cardStyle = "border-gray-200 bg-white";
                if(c.title.includes('üî•')) cardStyle = "border-orange-300 ring-1 ring-orange-100 bg-orange-50/30";
                if(c.title.includes('üëë')) cardStyle = "border-yellow-400 bg-gradient-to-r from-yellow-50 to-white shadow-md";

                html += `
                <div class="border rounded-xl p-4 shadow-sm hover:shadow-md transition mb-3 ${cardStyle} animate-fade-in">
                    <div class="flex justify-between items-start gap-2">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg text-gray-800 leading-tight">${c.title}</h3>
                            <div class="text-sm text-gray-600 mt-2 space-y-1">${c.detail}</div>
                        </div>
                        <div class="text-right min-w-[85px] shrink-0">
                            <div class="text-xl font-bold text-promed">${formatter.format(c.price)}‡∏ø</div>
                            ${isDiscount ? `<div class="price-strike">${formatter.format(c.fullPrice)}‡∏ø</div>` : ''}
                        </div>
                    </div>
                </div>`;
            });
            
            document.getElementById('contentContainer').innerHTML = html;
        }

        // ==========================================
        // üñ±Ô∏è USER INTERACTION LOGIC
        // ==========================================
        
        // ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ
        function setLogo() { 
            if(LOGO_FILE_ID) { 
                const url = `https://drive.google.com/thumbnail?id=${LOGO_FILE_ID}&sz=w1000`; 
                document.getElementById('logoImgInfo').src = url; 
                document.getElementById('logoImgForm').src = url; 
            } 
        }

        // PDPA
        document.getElementById('pdpaCheckbox').addEventListener('change', function() { 
            const btn = document.getElementById('pdpaBtn'); 
            if (this.checked) { 
                btn.disabled = false; 
                btn.classList.remove('bg-gray-300', 'cursor-not-allowed'); 
                btn.classList.add('bg-promed', 'hover:bg-[#7ab332]', 'shadow-lg'); 
            } else { 
                btn.disabled = true; 
                btn.classList.add('bg-gray-300', 'cursor-not-allowed'); 
                btn.classList.remove('bg-promed', 'hover:bg-[#7ab332]', 'shadow-lg'); 
            } 
        });

        document.getElementById('pdpaBtn').addEventListener('click', function() { 
            document.getElementById('pdpaModal').classList.add('hidden'); 
            document.getElementById('courseInfoPage').classList.remove('hidden'); 
            window.scrollTo(0, 0); 
        });

        // Navigation
        document.getElementById('goToRegisterBtn').addEventListener('click', function() { 
            document.getElementById('courseInfoPage').classList.add('hidden'); 
            document.getElementById('regisFormPage').classList.remove('hidden'); 
            window.scrollTo(0, 0); 
        });

        document.getElementById('backToInfoBtn').addEventListener('click', function() {
            document.getElementById('regisFormPage').classList.add('hidden'); 
            document.getElementById('courseInfoPage').classList.remove('hidden'); 
            window.scrollTo(0, 0); 
        });
        
        // ==========================================
        // üì§ SUBMIT FORM
        // ==========================================
        document.getElementById('regisForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const spinner = document.getElementById('loadingSpinner');
            const btnText = btn.querySelector('span');
            
            // ‡∏•‡πá‡∏≠‡∏Ñ‡∏õ‡∏∏‡πà‡∏°
            btn.disabled = true; 
            btnText.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'; 
            spinner.classList.remove('hidden');

            const formData = {
                userId: document.getElementById('userId').value,
                fullname: document.getElementById('fullname').value,
                nickname: document.getElementById('nickname').value,
                age: document.getElementById('age').value,
                education: document.getElementById('education').value,
                email: document.getElementById('email').value,
                lineId: document.getElementById('lineId').value,
                phoneStudent: document.getElementById('phoneStudent').value,
                phoneParent: document.getElementById('phoneParent').value,
                subject: document.getElementById('subject').value,
                hours: "-",
                preferredTime: document.getElementById('preferredTime').value
            };

            try {
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
                await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify(formData), 
                    mode: 'no-cors' 
                });
                
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire({ 
                    title: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                    text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡πÑ‡∏•‡∏ô‡πå‡∏Ñ‡∏£‡∏±‡∏ö', 
                    icon: 'success', 
                    confirmButtonColor: '#8DC63F',
                    confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ'
                }).then(() => { 
                    liff.closeWindow(); 
                });

            } catch (err) {
                console.error(err);
                Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                btn.disabled = false; 
                btnText.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô'; 
                spinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>

